<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Jump Frame Trainer (Unofficial)</title>

<style>
/* ===== ãƒ™ãƒ¼ã‚¹ ===== */
body{
  background:#0e0e0e;
  color:#fff;
  font-family:system-ui,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
  margin:0;
  user-select:none;
}

/* ===== ãƒ‘ãƒãƒ« ===== */
.box{
  position:relative;
  width:min(96vw, 880px);
  height:min(96vh, 800px);
  padding:32px 36px;
  border-radius:16px;
  background: rgba(40, 40, 40, 0.45);
  box-shadow:0 0 0 1px rgba(255,255,255,0.15);
  box-sizing:border-box;

  display:flex;
  flex-direction:column;
}

/* ===== ãƒ¡ã‚¤ãƒ³é ˜åŸŸ ===== */
.main{
  display:flex;
  flex-direction:column;
  flex:1;
}

/* ===== è¡¨ç¤º ===== */
.title{text-align:center;font-size:18px;opacity:.85;}
.input{text-align:center;font-size:14px;opacity:.7;margin-bottom:4px;}
.count{text-align:center;font-size:72px;font-weight:700;}
.avg{text-align:center;font-size:18px;opacity:.85;margin-top:2px;}
.zone-name{text-align:center;font-size:15px;margin-bottom:10px;}

/* ===== ã‚µã‚¦ãƒ³ãƒ‰ ===== */
.sound-toggle{
  font-size:22px;
  cursor:pointer;
  opacity:.8;
}

.sound-toggle:hover{opacity:1;transform:scale(1.1);}
.sound-toggle.muted{opacity:.45;}

.input-hint{
  margin-top:6px;
  text-align:center;
  font-size:13px;
  color:rgba(255,255,255,.7);
  letter-spacing:.02em;
}

/* ===== ãƒ¡ãƒ¼ã‚¿ãƒ¼ ===== */
.meter-wrap{margin:10px 0 18px;}

.meter{
  position:relative;
  height:26px;
  border-radius:12px;
  background:rgba(255,255,255,.08);
  overflow:hidden;
}

/* ã‚¾ãƒ¼ãƒ³è‰² */
.meter-zones{
  position:absolute;
  inset:0;
  display:flex;
}

/* 1â€“7 */
.mz.tap{
  width:calc(7/36*100%);
  background:rgba(202,167,255,.18);
}

/* 8â€“13 */
.mz.small{
  width:calc(6/36*100%);
  background:rgba(106,183,255,.18);
}

/* 14â€“24 */
.mz.mid{
  width:calc(11/36*100%);
  background:rgba(125,255,156,.18);
}

/* 25â€“35ï¼ˆå†…éƒ¨ã§æ­£ç¢ºã«åˆ†å‰²ï¼‰ */
.mz.large{
  width:calc(11/36*100%);
  background: linear-gradient(
    90deg,

    /* 25â€“29F : é€šå¸¸å¤§ã‚¸ãƒ£ãƒ³ãƒ—è‰² (5/11) */
    rgba(255,159,106,.18) 0%,
    rgba(255,159,106,.18) calc(5/11*100%),

    /* 30â€“35F : è­¦å‘Šã‚¾ãƒ¼ãƒ³ (6/11) */
    rgba(200,120,40,.28) calc(5/11*100%),
    rgba(220,90,40,.38) calc(8/11*100%),
    rgba(200,60,60,.48) 100%
  );
}

/* 36 */
.mz.full{
  width:calc(1/36*100%);
  background:rgba(255,106,106,.22);
}


/* ãƒãƒ¼ã‚«ãƒ¼ */
.marker{
  position:absolute;
  top:0; bottom:0;
  width:3px;
  background:#fff;
  box-shadow:0 0 0 2px rgba(0,0,0,.35);
  z-index:3;
}

/* ç›®ç››ã‚Š */
.ticks{
  position:absolute;
  inset:0;
  display:grid;
  grid-template-columns:repeat(36,1fr);
  pointer-events:none;
  z-index:2;
}
.tick{position:relative;}
.tick::after{
  content:"";
  position:absolute;
  right:0; bottom:0;
  width:1px; height:45%;
  background:rgba(255,255,255,.22);
}
.tick.major::after{
  height:80%;
  background:rgba(255,255,255,.55);
}

.labels{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  opacity:.55;
  margin-top:4px;
}

/* ===== ã‚¾ãƒ¼ãƒ³ä¸€è¦§ ===== */
.zones{display:flex;flex-direction:column;gap:6px;}
.zone{
  padding:8px 12px;
  border-radius:8px;
  opacity:.35;
}
.zone.active{
  opacity:1;
  box-shadow:0 0 0 2px currentColor;
}

.tap{color:#caa7ff;background:rgba(202,167,255,.18);}
.small{color:#6ab7ff;background:rgba(106,183,255,.18);}
.mid{color:#7dff9c;background:rgba(125,255,156,.18);}
.large{color:#ff9f6a;background:rgba(255,159,106,.18);}
.large.warning{
  background: linear-gradient(
    90deg,
    rgba(200, 120, 40, 0.35) 0%,
    rgba(220, 90, 40, 0.45) 50%,
    rgba(200, 60, 60, 0.55) 100%
  );
}
.full{color:#ff6a6a;background:rgba(255,106,106,.22);}

/* ===== æ³¨é‡ˆ ===== */
.note{
  margin-top:20px;
  font-size:12px;
  line-height:1.5;
  text-align:center;
  color:rgba(255,255,255,.55);
}

.notice{
  margin-top:14px;
  font-size:12px;
  text-align:center;
  color:rgba(255,255,255,.55);
}
.notice details summary{
  cursor:pointer;
  font-size:11px;
  opacity:.6;
}
.notice details summary:hover{opacity:.9;}
.notice details p{
  margin:6px 0;
  font-size:11px;
  opacity:.55;
}

/* ===== ãƒ•ãƒƒã‚¿ãƒ¼ ===== */
.disclaimer{
  margin-top:18px;
  padding-top:14px;
  font-size:12px;
  color:rgba(255,255,255,.45);
  text-align:center;
  border-top:1px solid rgba(255,255,255,.08);
}

/* ===== éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ===== */
.sound-control{
  position:absolute;
  top:16px;
  right:18px;

  display:flex;
  flex-direction:row;
  align-items:center;
  gap:8px;
}

.volume-slider{
  width:100px;
  accent-color:#bbb;
  opacity:.85;
}
.volume-slider:hover{opacity:1;}

</style>
</head>

<body>
<div class="box">

  <div class="sound-control">
    <div id="soundToggle" class="sound-toggle" title="ã‚µã‚¦ãƒ³ãƒ‰åˆ‡æ›¿">ğŸ”Š</div>

    <!-- éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆ0â€“200%ï¼‰ -->
    <input
      id="volumeSlider"
      class="volume-slider"
      type="range"
      min="0"
      max="200"
      value="100"
      step="1"
      title="éŸ³é‡"
    />
  </div>


  <div class="main">
    <div class="title">Jump King Frame Trainer (Unofficial)</div>
    <div id="input" class="input">å…¥åŠ›å¾…ã¡â€¦ï¼ˆã‚­ãƒ¼ / ãƒ‘ãƒƒãƒ‰ / ãƒã‚¦ã‚¹ï¼‰</div>
    <div class="input-hint">
      âŒ¨ï¸ ã‚­ãƒ¼ / ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ / ğŸ–±ï¸ ãƒã‚¦ã‚¹å·¦ã‚¯ãƒªãƒƒã‚¯å¯¾å¿œ
    </div>
    <div id="count" class="count">0</div>
    <div id="avg" class="avg">å¹³å‡ï¼ˆç›´è¿‘5å›ï¼‰ï¼šâ€”</div>
    <div id="zoneName" class="zone-name">â€”</div>

    <div class="meter-wrap">
      <div class="meter">
        <div class="meter-zones">
          <div class="mz tap"></div>
          <div class="mz small"></div>
          <div class="mz mid"></div>
          <div class="mz large"></div>
          <div class="mz full"></div>
        </div>
        <div id="marker" class="marker"></div>
        <div id="ticks" class="ticks"></div>
      </div>
      <div class="labels">
        <span>0</span><span>6</span><span>12</span>
        <span>18</span><span>24</span><span>30</span><span>36</span>
      </div>
    </div>

    <div class="zones">
      <div id="z-tap" class="zone tap">ã‚¿ãƒƒãƒ— / å¾®ã‚¸ãƒ£ãƒ³ãƒ— (1â€“7f)</div>
      <div id="z-small" class="zone small">å°ã‚¸ãƒ£ãƒ³ãƒ— (8â€“13f)</div>
      <div id="z-mid" class="zone mid">ä¸­ã‚¸ãƒ£ãƒ³ãƒ— (14â€“24f)</div>
      <div id="z-large" class="zone large">å¤§ã‚¸ãƒ£ãƒ³ãƒ— (25â€“35f)</div>
      <div id="z-full" class="zone full">ãƒ•ãƒ«ã‚¸ãƒ£ãƒ³ãƒ— (36f)</div>
    </div>

    <div class="note">
      â€» è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¸ãƒ£ãƒ³ãƒ—åŒºåˆ†ã¯ç›®å®‰ã§ã™ã€‚<br>
      å®Ÿéš›ã®ãƒ—ãƒ¬ã‚¤ã§ã¯ãƒ•ãƒ¬ãƒ¼ãƒ æ•°ãã®ã‚‚ã®ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚
    </div>

    <div class="notice">
      â„¹ï¸ è¡¨ç¤ºã®ç›®ç››ã‚Šã¯ç’°å¢ƒã«ã‚ˆã‚Šã‚ºãƒ¬ã¦è¦‹ãˆã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ˆæ•°å€¤ã¯æ­£ç¢ºã§ã™ï¼‰
      <details>
        <summary>è©³ç´°ã‚’è¦‹ã‚‹</summary>
        <p>æœ¬ãƒ„ãƒ¼ãƒ«ã¯ Jump King ã®æŒ™å‹•ã«åˆã‚ã›ã€60fpsåŸºæº–ã§è¨ˆæ¸¬ã—ã¦ã„ã¾ã™ã€‚</p>
        <p>é«˜ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ãƒˆç’°å¢ƒã«å¯¾å¿œã•ã›ãŸãŸã‚ã€è¡¨ç¤ºã®ã¿ã‚ºãƒ¬ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
      </details>
    </div>
  </div>

  <!-- æ–‡ç« ã¯å‰Šã‚‰ãšãã®ã¾ã¾ -->
  <div class="disclaimer">
    <p>
      â€» æœ¬ãƒ„ãƒ¼ãƒ«ã¯ <strong>éå…¬å¼</strong> ã®ãƒ•ã‚¡ãƒ³ãƒ¡ã‚¤ãƒ‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
      Jump King ãŠã‚ˆã³é–¢é€£ã™ã‚‹åç§°ãƒ»æ¨©åˆ©ã¯ã€å„æ¨©åˆ©è€…ã«å¸°å±ã—ã¾ã™ã€‚
    </p>
    <p>
      This is an <strong>unofficial</strong> fan-made training tool.<br>
      Jump King and related names are trademarks or registered trademarks of their respective owners.<br>
      Made by ChatGPT
    </p>
  </div>

</div>

<script>
/* ===== ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Œå…¨ä¿®æ­£ç‰ˆï¼‰ ===== */
const LOGIC_FPS = 60;
const FRAME_MS  = 1000 / LOGIC_FPS;
const MAX = 36;

const ZONES = [
  {k:"tap",   name:"ã‚¿ãƒƒãƒ— / å¾®ã‚¸ãƒ£ãƒ³ãƒ—", min:1,  max:7 },
  {k:"small", name:"å°ã‚¸ãƒ£ãƒ³ãƒ—",           min:8,  max:13},
  {k:"mid",   name:"ä¸­ã‚¸ãƒ£ãƒ³ãƒ—",           min:14, max:24},
  {k:"large", name:"å¤§ã‚¸ãƒ£ãƒ³ãƒ—",           min:25, max:35},
  {k:"full",  name:"ãƒ•ãƒ«ã‚¸ãƒ£ãƒ³ãƒ—",         min:36, max:36},
];

const history = []; // ç›´è¿‘5å›
const PAD_JUMP_BUTTONS = [0]; // Gamepad jump buttons (A button)

/* ===== DOM ===== */
const countEl    = document.getElementById("count");
const avgEl      = document.getElementById("avg");
const zoneNameEl = document.getElementById("zoneName");
const markerEl   = document.getElementById("marker");
const inputEl    = document.getElementById("input");
const ticksEl    = document.getElementById("ticks");
const soundToggle= document.getElementById("soundToggle");
const volumeSlider = document.getElementById("volumeSlider");
if(volumeSlider){
  volumeSlider.addEventListener("input", () => {
    masterGain = Number(volumeSlider.value) / 100; // 0.0 â€“ 2.0
    if(gainNode) gainNode.gain.value = masterGain;
  });
}

const zoneEls = {
  tap:   document.getElementById("z-tap"),
  small: document.getElementById("z-small"),
  mid:   document.getElementById("z-mid"),
  large: document.getElementById("z-large"),
  full:  document.getElementById("z-full"),
};

/* ===== ç›®ç››ã‚Šç”Ÿæˆï¼ˆé‡è¤‡é˜²æ­¢ï¼‰ ===== */
if (ticksEl && ticksEl.childElementCount === 0) {
  for(let i=1;i<=MAX;i++){
    const d = document.createElement("div");
    d.className = "tick" + (i % 6 === 0 ? " major" : "");
    ticksEl.appendChild(d);
  }
}

let masterGain = 1.0;
let gainNode = null;

/* ===== Audio ===== */
let soundEnabled = true;
const AC = window.AudioContext || window.webkitAudioContext;
const audioCtx = AC ? new AC() : null;

function ensureAudioUnlocked(){
  if(!audioCtx) return;
  if(audioCtx.state === "suspended") audioCtx.resume();
}

function beep(freq, dur, gain = 0.08){
  if(!audioCtx || !soundEnabled) return;

  // â€» ã“ã“ã§ resume ã ã‘ã—ã¦ã‚‚ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¤–ã€ã ã¨ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚
  // startHold/ã‚µã‚¦ãƒ³ãƒ‰ãƒœã‚¿ãƒ³å†…ã§ã‚‚å¿…ãš unlock ã™ã‚‹
  if(audioCtx.state === "suspended") return;

  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = freq;
  g.gain.value = gain;

  o.connect(g);
  g.connect(gainNode || audioCtx.destination);

  o.start();
  o.stop(audioCtx.currentTime + dur);
}

const sounds = {
  tap:   () => beep(1200, 0.04),
  small: () => beep(950,  0.05),
  mid:   () => { beep(950,0.05); setTimeout(()=>beep(1050,0.05), 80); },
  large: () => beep(180,  0.12),
  full:  () => beep(90,   0.18, 0.12),
};

if(audioCtx){
  gainNode = audioCtx.createGain();
  gainNode.gain.value = masterGain;
  gainNode.connect(audioCtx.destination);
}

/* ===== ã‚µã‚¦ãƒ³ãƒ‰ãƒˆã‚°ãƒ« ===== */
if (soundToggle) {
  soundToggle.addEventListener("click", () => {
    soundEnabled = !soundEnabled;
    soundToggle.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
    soundToggle.classList.toggle("muted", !soundEnabled);

    // ã‚¯ãƒªãƒƒã‚¯ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãªã®ã§ã€ã“ã“ã§ç¢ºå®Ÿã«è§£é™¤ã§ãã‚‹
    ensureAudioUnlocked();

    // â˜… éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨æ•´åˆã•ã›ã‚‹
    if (gainNode) {
      gainNode.gain.value = soundEnabled ? masterGain : 0;
    }
  });
}

/* ===== çŠ¶æ…‹ ===== */
let holding = false;
let startTime = 0;
let lastZone = null;
// === Gamepad state ===
let padPrevPressed = false;

/* ===== utils ===== */
function getZone(f){
  return ZONES.find(z => f >= z.min && f <= z.max) || null;
}
function clearZones(){
  Object.values(zoneEls).forEach(el => {
    el.classList.remove("active");
    el.classList.remove("warning");
  });
}
function updateAverage(){
  if(!history.length){
    avgEl.textContent = "å¹³å‡ï¼ˆç›´è¿‘5å›ï¼‰ï¼šâ€”";
    return;
  }
  const avg = (history.reduce((a,b)=>a+b,0) / history.length).toFixed(1);
  avgEl.textContent = `å¹³å‡ï¼ˆç›´è¿‘5å›ï¼‰ï¼š${avg} f`;
}

/* ===== æç”» ===== */
function render(){
  pollGamepad();

  if (holding) {
    const f  = (performance.now() - startTime) / FRAME_MS;
    const fi = Math.max(0, Math.min(MAX, Math.round(f)));

    // â˜… 30F åˆ°é”æ™‚ã®è¿½åŠ éŸ³ï¼ˆ1å›ã ã‘ï¼‰
    if (fi === 30 && !played30f) {
      beep(300, 0.08, 0.1);
      played30f = true;
    }

    countEl.textContent = String(fi);
    markerEl.style.left = (Math.min(f / MAX, 1) * 100) + "%";

    clearZones();
    const z = getZone(fi);
    zoneNameEl.textContent = z ? z.name : "â€”";

    // â˜… z ãŒã‚ã‚‹æ™‚ã ã‘å‡¦ç†
    if (z) {
      zoneEls[z.k].classList.add("active");

      // â˜… 30â€“35F ã¯è­¦å‘Šã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (z.k === "large" && fi >= 30) {
        zoneEls.large.classList.add("warning");
      }

      // â˜… ã‚¾ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆéŸ³
      if (z.k !== lastZone) {
        sounds[z.k]?.();
        lastZone = z.k;
      }
    }
  }

  requestAnimationFrame(render);
}
requestAnimationFrame(render);

/* ===== å…¥åŠ› ===== */
function startHold(label){
  // ã“ã“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚¤ãƒ™ãƒ³ãƒˆå†…ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ã®ã§ã€è§£é™¤ã§ãã‚‹
  ensureAudioUnlocked();

  holding = true;
  startTime = performance.now();
  lastZone = null;
  inputEl.textContent = label;
  played30f = false; // â˜… ãƒ›ãƒ¼ãƒ«ãƒ‰é–‹å§‹æ™‚ã«ãƒªã‚»ãƒƒãƒˆ
}

function endHold(){
  if(!holding) return;

  const fi = Math.max(0, Math.min(MAX, Math.round((performance.now() - startTime) / FRAME_MS)));
  holding = false;

  history.push(fi);
  if(history.length > 5) history.shift();
  updateAverage();

  // è¡¨ç¤ºã‚’è½ã¡ç€ã‹ã›ãŸã„å ´åˆã¯ã“ã“ã§æˆ»ã—ã¦ã‚‚OKï¼ˆä»Šã¯ä¿æŒï¼‰
  // inputEl.textContent = "å…¥åŠ›å¾…ã¡â€¦ï¼ˆã‚­ãƒ¼ / ãƒ‘ãƒƒãƒ‰ / ãƒã‚¦ã‚¹ï¼‰";
}

/* ã‚­ãƒ¼ */
window.addEventListener("keydown", (e) => {
  if(holding) return;
  if(e.repeat) return;
  startHold(`ã‚­ãƒ¼: ${e.code}`);
});
window.addEventListener("keyup", () => {
  if(holding) endHold();
});

/* ãƒã‚¦ã‚¹ */
window.addEventListener("mousedown", (e) => {
  if(e.button !== 0) return;
  if(holding) return;
  startHold("ãƒã‚¦ã‚¹: å·¦ã‚¯ãƒªãƒƒã‚¯");
});
window.addEventListener("mouseup", (e) => {
  if(e.button !== 0) return;
  if(holding) endHold();
});

window.addEventListener("gamepadconnected", () => {
  console.log("Gamepad connected");
});

window.addEventListener("gamepaddisconnected", () => {
  padPrevPressed = false;
});

function pollGamepad() {
  const pads = navigator.getGamepads?.();
  if (!pads) return;

  const pad = pads[0];
  if (!pad) return;

  const pressed = pad.buttons.some(btn => btn?.pressed);

  if (pressed && !padPrevPressed) {
    startHold("pad");
  }
  if (!pressed && padPrevPressed) {
    endHold("pad");
  }

  padPrevPressed = pressed;
}

updateAverage();
</script>
</body>
</html>


